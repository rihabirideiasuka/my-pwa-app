<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>体力測定記録</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.3/css/bulma.min.css">
</head>
<body>
  <section class="section">
    <div class="container">
      <h1 class="title">体力測定記録フォーム</h1>

      <div class="field">
        <label class="label">氏名</label>
        <div class="control">
          <input class="input" type="text" id="name">
        </div>
      </div>

      <div class="field">
        <label class="label">実施日</label>
        <div class="control">
          <input class="input" type="date" id="date">
        </div>
      </div>

      <div class="field">
        <label class="label">身長 (cm)</label>
        <div class="control">
          <input class="input" type="number" id="height">
        </div>
      </div>

      <div class="field">
        <label class="label">体重 (kg)</label>
        <div class="control">
          <input class="input" type="number" id="weight">
        </div>
      </div>

      <div class="field">
        <label class="label">右握力 (kg)</label>
        <div class="control">
          <input class="input" type="number" id="rightGrip">
        </div>
      </div>

      <div class="field">
        <label class="label">左握力 (kg)</label>
        <div class="control">
          <input class="input" type="number" id="leftGrip">
        </div>
      </div>

      <div class="field">
        <label class="label">右片足立ち (秒)</label>
        <div class="control">
          <input class="input" type="number" id="rightLeg">
        </div>
      </div>

      <div class="field">
        <label class="label">左片足立ち (秒)</label>
        <div class="control">
          <input class="input" type="number" id="leftLeg">
        </div>
      </div>

      <div class="field">
        <label class="label">TUGテスト1回目 (秒)</label>
        <div class="control">
          <input class="input" type="number" id="tug1">
        </div>
      </div>

      <div class="field">
        <label class="label">TUGテスト2回目 (秒)</label>
        <div class="control">
          <input class="input" type="number" id="tug2">
        </div>
      </div>

      <div class="field">
        <label class="label">10m歩行 (秒)</label>
        <div class="control">
          <input class="input" type="number" id="time10m">
        </div>
      </div>

      <div class="field">
        <label class="label">歩数</label>
        <div class="control">
          <input class="input" type="number" id="steps">
        </div>
      </div>

      <div class="field">
        <label class="label">備考</label>
        <div class="control">
          <textarea class="textarea" id="note"></textarea>
        </div>
      </div>

      <div class="field">
        <label class="label">歩行条件</label>
        <div class="control">
          <div class="select">
            <select id="condition">
              <option value="">選択してください</option>
              <option value="自立">自立</option>
              <option value="杖">杖</option>
              <option value="歩行器">歩行器</option>
              <option value="介助あり">介助あり</option>
              <option value="その他">その他（下に記入）</option>
            </select>
          </div>
        </div>
        <div class="control mt-2">
          <input class="input" type="text" id="conditionOther" placeholder="その他の場合は記入">
        </div>
      </div>

      <div class="buttons mt-5">
        <button class="button is-primary" onclick="saveRecord()">記録を保存</button>
        <button class="button is-link" onclick="downloadCSV()">CSVダウンロード</button>
        <button class="button is-warning" onclick="sendData()">データ送信</button>
      </div>

    </div>
  </section>

  <script>
    function getFormData() {
      return {
        name: document.getElementById('name').value,
        date: document.getElementById('date').value,
        height: document.getElementById('height').value,
        weight: document.getElementById('weight').value,
        rightGrip: document.getElementById('rightGrip').value,
        leftGrip: document.getElementById('leftGrip').value,
        rightLeg: document.getElementById('rightLeg').value,
        leftLeg: document.getElementById('leftLeg').value,
        tug1: document.getElementById('tug1').value,
        tug2: document.getElementById('tug2').value,
        time10m: document.getElementById('time10m').value,
        steps: document.getElementById('steps').value,
        note: document.getElementById('note').value,
        condition: document.getElementById('condition').value || document.getElementById('conditionOther').value
      };
    }

    function saveRecord() {
      const record = getFormData();
      const records = JSON.parse(localStorage.getItem('records') || '[]');
      records.push(record);
      localStorage.setItem('records', JSON.stringify(records));
      alert("記録を保存しました！");
    }

    function downloadCSV() {
      const records = JSON.parse(localStorage.getItem('records') || '[]');
      if (records.length === 0) return alert("記録がありません");

      const header = Object.keys(records[0]);
      const csv = [header.join(",")].concat(
        records.map(row => header.map(field => `"${row[field]}"`).join(","))
      ).join("\n");

      const blob = new Blob([csv], { type: 'text/csv' });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = "体力測定記録.csv";
      link.click();
    }

    function sendData() {
      const record = getFormData();

      fetch("https://script.google.com/macros/s/AKfycbwFd8eQIAuO-mSdALoF6m1J8wtXhD5l3JNLEwASLnvpX5RyRNqpQQmek98czM-fcBPi/exec", {
        method: "POST",
        body: JSON.stringify(record),
        headers: { "Content-Type": "application/json" }
      })
      .then(response => response.text())
      .then(data => alert("データ送信完了：" + data))
      .catch(error => alert("エラーが発生しました：" + error));
    }
  </script>
</body>
</html>
